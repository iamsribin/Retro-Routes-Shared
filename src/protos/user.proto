syntax = "proto3";

package user_package;

// =====================
// Service
// =====================
service User {
  rpc Register(RegisterRequest) returns (RegisterResponse);
  rpc CheckUser(CheckUserRequest) returns (CheckUserResponse);
  rpc ResendOtp(ResendOtpRequest) returns (ResendOtpResponse);
  rpc CheckGoogleLoginUser(CheckGoogleLoginUserRequest) returns (CheckGoogleLoginUserResponse);
  rpc CheckLoginUser(CheckLoginUserRequest) returns (CheckLoginUserResponse);

  rpc GetActiveUser(Id) returns (GetUserResponse);
  rpc ProfileUpdate(ProfileUpdateRequest) returns (ProfileUpdateResponse);
  rpc AddWalletBalance(AddWalletBalanceRequest) returns (AddWalletBalanceResponse);
  rpc RideCancelUpdate(RideCancelUpdateRequest) returns (RideCancelUpdateResponse);
  rpc RidePayment(RidePaymentRequest) returns (RidePaymentResponse);
  rpc RazorpayPayment(RazorpayPaymentRequest) returns (RazorpayPaymentResponse);

  rpc AdminLogin(AdminLoginRequest) returns (AdminLoginResponse);
  rpc AdminGetUsersList(PaginationQuery) returns (AdminGetDataResponse);
  rpc AdminGetUserData(Id) returns (AdminGetUserDataResponse);
  rpc AdminGetBlockedUsers(Empty) returns (AdminGetBlockedDataResponse);
  rpc AdminUpdateUserStatus(AdminUpdateUserStatusRequest) returns (AdminUpdateUserStatusResponse);
  rpc AdminDashboardData(AdminDashboardDataRequest) returns (AdminDashboardDataResponse);

  rpc FetchUserProfile(Id) returns (FetchUserProfileRes);
}

// =====================
// Common Models
// =====================

message Transaction {
  string details = 1;
  double amount = 2;
  string status = 3;
  string id = 4;
  string formattedDate = 5;
}

message WalletTransaction {
  string date = 1;
  double amount = 2;
  string status = 3;
}

message Wallet {
  double balance = 1;
  repeated Transaction transactions = 2;
}

message ProfileWallet {
  double balance = 1;
  double transactions = 2;
}

message RideDetails {
  int32 completedRides = 1;
  int32 cancelledRides = 2;
}

// =====================
// User Data
// =====================

message UserProfile {
  string id = 1;
  string name = 2;
  string email = 3;
  string mobile = 4;
  string userImage = 5;
  string referralCode = 6;
  string joiningDate = 7;
  string accountStatus = 8;
  ProfileWallet wallet = 9;
  RideDetails rideDetails = 10;
}

message UserDatas {
  string name = 1;
  string mobile = 2;
  string email = 3;
  string accountStatus = 4;
  string referralCode = 5;
  string formattedDate = 6;
  string userImage = 7;
  Wallet wallet = 8;
  RideDetails rideDetails = 9;
  repeated Transaction formattedTransactions = 10;
}

// =====================
// Pagination
// =====================

message PaginationQuery {
  string page = 1;
  string limit = 2;
  string search = 3;
  string status = 4;
}

message PaginationInfo {
  int32 currentPage = 1;
  int32 totalPages = 2;
  int32 totalItems = 3;
  int32 itemsPerPage = 4;
  bool hasNextPage = 5;
  bool hasPreviousPage = 6;
}

// =====================
// Auth & Profile
// =====================

message RegisterRequest {
  string name = 1;
  string email = 2;
  string mobile = 3;
  string password = 4;
  string referredCode = 5;
  string otp = 6;
  string token = 7;
  string userImage = 8;
}

message RegisterResponse {
  string message = 1;
}

message CheckUserRequest {
  string email = 1;
  string mobile = 2;
  string name = 3;
}

message CheckUserResponse {
  string message = 1;
  string token = 2;
}

message ResendOtpRequest {
  string email = 1;
  string name = 2;
}

message ResendOtpResponse {
  string message = 1;
  string token = 2;
}

message CheckGoogleLoginUserRequest {
  string email = 1;
}

message CheckGoogleLoginUserResponse {
  string message = 1;
  string name = 2;
  string token = 3;
  string id = 4;
  string refreshToken = 5;
  string role = 6;
}

message CheckLoginUserRequest {
  string mobile = 1;
}

message CheckLoginUserResponse {
  string message = 1;
  string name = 2;
  string token = 3;
  string _id = 4;
  string refreshToken = 5;
  string role = 6;
  string profile = 7;
  string mobile = 8;
}

message ProfileUpdateRequest {
  string id = 1;
  string name = 2;
  string mobile = 3;
  string email = 4;
}

message ProfileUpdateResponse {
  string message = 1;
  UserDatas newData = 2;
}

// =====================
// Wallet / Payments
// =====================

message AddWalletBalanceRequest {
  string id = 1;
  double balance = 2;
}

message AddWalletBalanceResponse {
  string message = 1;
}

message RideCancelUpdateRequest {
  string userId = 1;
}

message RideCancelUpdateResponse {
  string message = 1;
}

message RidePaymentRequest {
  string paymentMode = 1;
  string userId = 2;
  string rideId = 3;
  double amount = 4;
  string razorpayOrderId = 5;
  string razorpayPaymentId = 6;
  string razorpaySignature = 7;
}

message RidePaymentResponse {
  string message = 1;
  int32 statusCode = 2;
}

message RazorpayPaymentRequest {
  double amount = 1;
}

message RazorpayPaymentResponse {
  double amount = 1;
  double amountDue = 2;
  double amountPaid = 3;
  int32 attempts = 4;
  int64 createdAt = 5;
  string currency = 6;
  string entity = 7;
  string id = 8;
  repeated string notes = 9;
  string offerId = 10;
  string receipt = 11;
  string status = 12;
}

// =====================
// Admin
// =====================

message AdminLoginRequest {
  string email = 1;
  string password = 2;
}

message AdminLoginResponse {
  string message = 1;
  string email = 2;
  string token = 3;
}

message AdminGetDataResponse {
  repeated UserSummary users = 1;
  PaginationInfo pagination = 2;
}

message UserSummary {
  string id = 1;
  string name = 2;
  string email = 3;
  string mobile = 4;
  string userImage = 5;
  string referralCode = 6;
  string accountStatus = 7;
  string joiningDate = 8;
}

message AdminGetBlockedDataResponse {
  repeated UserSummary users = 1;
}

message AdminUpdateUserStatusRequest {
  string id = 1;
  string status = 2;
  string reason = 3;
}

message AdminUpdateUserStatusResponse {
  string message = 1;
}

message AdminGetUserDataResponse {
  string id = 1;
  string name = 2;
  string email = 3;
  string mobile = 4;
  string userImage = 5;
  string referralCode = 6;
  string accountStatus = 7;
  double balance = 8;
  int32 totalTransactions = 9;
  int32 completedRides = 10;
  int32 cancelledRides = 11;
  string joiningDate = 12;
  string reason = 13;
}

message AdminDashboardDataRequest {}

message AdminDashboardDataResponse {
  repeated UserStat stats = 1;
  int32 totalUsers = 2;
  int32 blockedUsers = 3;
}

message UserStat {
  int32 userCount = 1;
  int32 month = 2;
}

// =====================
// Misc
// =====================
message Id {
  string id = 1;
}

message GetUserResponse {
  UserDatas newData = 1;
}

message FetchUserProfileRes {
  int32 status = 1;
  string message = 2;
  UserProfile data = 3;
}

message Empty {}
